function sprintf(){var e=/%%|%(\d+\$)?([-+#0 ]*)(\*\d+\$|\*|\d+)?(\.(\*\d+\$|\*|\d+))?([scboxXuidfegEG])/g,t=arguments,n=0,a=t[n++],o=function(e,t,n,a){var o=e.length>=t?"":Array(1+t-e.length>>>0).join(n);return a?e+o:o+e},r=function(e,t,n,a,r){var i=a-e.length;return i>0&&(e=n||!r?o(e,a," ",n):e.slice(0,t.length)+o("",i,"0",!0)+e.slice(t.length)),e},i=function(e,t,n,a,i,s,c){var l=e>>>0;return n=n&&l&&{2:"0b",8:"0",16:"0x"}[t]||"",e=n+o(l.toString(t),s||0,"0",!1),r(e,n,a,i,c)},s=function(e,t,n,a,o){return null!=a&&(e=e.slice(0,a)),r(e,"",t,n,o)},c=function(e,a,c,l,d,u,f){if("%%"==e)return"%";for(var p=!1,m="",h=!1,P=!1,v=0;c&&v<c.length;v++)switch(c.charAt(v)){case" ":m=" ";break;case"+":m="+";break;case"-":p=!0;break;case"0":h=!0;break;case"#":P=!0}if(l=l?"*"==l?+t[n++]:"*"==l.charAt(0)?+t[l.slice(1,-1)]:+l:0,l<0&&(l=-l,p=!0),!isFinite(l))throw new Error("sprintf: (minimum-)width must be finite");u=u?"*"==u?+t[n++]:"*"==u.charAt(0)?+t[u.slice(1,-1)]:+u:"fFeE".indexOf(f)>-1?6:"d"==f?0:void 0;var g=a?t[a.slice(0,-1)]:t[n++];switch(f){case"s":return s(String(g),p,l,u,h);case"c":return s(String.fromCharCode(+g),p,l,u,h);case"b":return i(g,2,P,p,l,u,h);case"o":return i(g,8,P,p,l,u,h);case"x":return i(g,16,P,p,l,u,h);case"X":return i(g,16,P,p,l,u,h).toUpperCase();case"u":return i(g,10,P,p,l,u,h);case"i":case"d":var $=parseInt(+g),A=$<0?"-":m;return g=A+o(String(Math.abs($)),u,"0",!1),r(g,A,p,l,h);case"e":case"E":case"f":case"F":case"g":case"G":var $=+g,A=$<0?"-":m,b=["toExponential","toFixed","toPrecision"]["efg".indexOf(f.toLowerCase())],k=["toString","toUpperCase"]["eEfFgG".indexOf(f)%2];return g=A+Math.abs($)[b](u),r(g,A,p,l,h)[k]();default:return e}};return a.replace(e,c)}function popUpShowTestFight(){$("#ifAuthDiv").hide()}function popUpHideTestFight(){$("#ifAuthDiv").show()}function array_empty(e){for(i in e)"object"==typeof e[i]?e[i]=array_empty(e[i]):e[i]||delete e[i];return e}var APP=APP||{};!function(){"use strict";var e=APP,t={};e.modules={},e.setParam=function(e,n){t[e]=n},e.getParam=function(e){return""!=typeof t[e]?t[e]:null}}(),function(){"use strict";APP.mediator=APP.events={};var e=APP.mediator,t={};e.subscribe=function(e,n,a){t[e]||(t[e]=[]),t[e].push({callback:n,context:a||{}})},e.publish=function(e){if(!t[e])return!1;for(var n=Array.prototype.slice.call(arguments,1),a=null,o=0,r=t[e].length;o<r;o++)a=t[e][o],a.callback.apply(a.context,n)}}(),function(){"use strict";APP.USER={};var e=APP.USER,t={};e.isGame=!1,e.isGuest=!0,e.init=function(n){t=n,e.isGuest=!1},e.setInGame=function(){e.isGame=!0},e.info=function(e){window.open("/user/info/?name="+e,"_blank")},e.setPicture=function(e){APP.FORM.send("/user/setPicture/",{type:"POST",data:{imageId:e}},function(e){e.picture&&($("#userPicture").attr("src",e.picture),$("#popup-dark").hide(),$("#popup-gallery").hide())})}}(),function(){"use strict";APP.I18N={};var e=APP.I18N,t="ru",n="ru",a={en:{"Некорректный email":"Incorrect email","Некорректный пароль":"Incorrect password","Некорректный логин":"Incorrect login","Введите логин и email":"Enter Login and Password","Введите логин":"Enter Login","Введите пароль":"Enter Password","Пароль изменен":"Password changed","Письмо отправленно":"Instructions for recovery sent to account e-mail","Нужно принять условия регистрации":"You must accept the terms of registration","Назначить лидером":"Appoint as Commander","Вы уверены, что хотите назначить лидером %s?":"Are you sure you wish to appoint %s as the new Commander?","Исключить из клана":"Exclude from Clan","Вы уверены, что хотите исключить из клана %s?":"Are you sure you wish to exclude %s from Clan?","Распустить клан":"DISBAND THE CLAN","Вы уверены, что хотите распустить клан?":"Are you sure you want to disband the Clan?","Сообщение отправленно":"Message sent","От":"From","Кому":"To","Закрыть":"Close","Слишком короткое имя персонажа":"Character name is too short","Слишком длинное имя персонажа":"Character name is too long","Имя персонажа не может начинаться с цифр":"Character name can't start with a number","Скачать игру могут только авторизованные пользователи":"You must be logged in to download the game"}};e.setLocale=function(e){n=e},e.getLocale=function(){return n},e.t=function(e){return n!==t&&"undefined"!=typeof a[n][e]&&(e=a[n][e]),e}}(),function(){"use strict";APP.EVENT={};var e=APP.EVENT,t={};e.subscribe=function(e,n,a){t[e]||(t[e]=[]),t[e].push({callback:n,context:a||{}})},e.publish=function(e){if(!t[e])return!1;for(var n=Array.prototype.slice.call(arguments,1),a=null,o=0,r=t[e].length;o<r;o++)a=t[e][o],a.callback.apply(a.context,n)}}(),function(){"use strict";APP.COMMON={};var e=APP.COMMON;e.toggleMenu=function(e){var t=function(){$("#"+e).animate({height:"toggle",opacity:"toggle"},{duration:"slow"})};APP.USER.isGame&&(t=function(){$("#"+e).hasClass("js-show")?$("#"+e).hide().removeClass("js-show"):$("#"+e).show().addClass("js-show"),$("#"+e).show()}),setTimeout(t,0)},e.activeMenu=function(e,t,n){for(var a=$("#menu-"+e).parents(),o=0,r=a.length;o<r&&t.length>0;o++)$(a[o]).hasClass("js-hidden")&&$(a[o]).show(),t=$.map(t,function(e){return $(a[o]).hasClass(e)?void $(a[o]).addClass(n):e})},e.showBigImage=function(e){$("#popup-image .js-popup-image").attr("src",e),APP.GALLERY.openBigSlider(e),APP.POPUP.show($("#popup-image"),{dark:!0})},e.changeLang=function(e){var t=document.location.host+document.location.pathname,n=t.match(/^(?:de|en|ja|ko)?\.?([a-zA-Z]+\.[a-zA-Z]{2,3})\/?([a-zA-Z]*)\/?(.*)$/);n&&"undefined"!=typeof n[3]&&"forum"!=n[3]&&"news"!==n[3]&&""!=n[3]?(console.log("match[3]"),"en"==e?document.location.href="http://"+n[1]+"/"+n[2]+"/"+n[3]:document.location.href="http://"+e+"."+n[1]+"/"+n[2]+"/"+n[3]):"en"==e?document.location.href="http://"+n[1]:document.location.href="http://"+e+"."+n[1]},e.getCode=function(){APP.FORM.send("/site/getCode/",{data:$("#form-getCode").serialize()},function(e){APP.POPUP.alert(e.message),yaCounter30811071.reachGoal("sentkey"),setTimeout(function(){APP.POPUP.clickDark()},2e3)})},e.checkCode=function(){APP.FORM.send("/site/checkCode/",{data:$("#form-checkCode").serialize()},function(e){APP.POPUP.alert(e.message),window.open("")})},e.postMessage=function(e){try{var t=JSON&&JSON.stringify?JSON.stringify(e):"";window.parent.postMessage(t,"*")}catch(e){return}},e.onPostMessage=function(e){try{JSON&&JSON.parse?JSON.parse(e.data):null}catch(e){}},$(window).on("message",e.onPostMessage),e.postMessage({message:"Portal init"}),window.onerror=function(t,n,a){e.postMessage({error:{message:t,url:n,line:a}})},e.gameLinks=function(){APP.USER.isGame&&e.setGameLinks()},e.setGameLinks=function(){$("a[target=_blank]").each(function(e,t){var n=$(t);n.attr("href");n.removeAttr("target")})},e.time=function(e,t){e=Number(e)||0;var n={};if(n.h=Math.floor(e/3600),e-=3600*n.h,n.m=Math.floor(e/60),e-=60*n.m,n.s=Math.floor(e),t)for(var a in n)n[a]=t(n[a]);return n},e.timer=function(t){var n=new Date;60*(n.getTimezoneOffset()+180);t=$.extend({timer:0,obj:null,callback:!1,interval:!0},t),t.timer=Number(t.timer)||0;var a={d:"д",h:"ч",m:"мин",s:"с"},o=0,r=function(){t.timer--,t.timer=Math.max(0,t.timer);var n=e.time(t.timer),r=[];r.push(sprintf("%02d",n.h)),r.push(sprintf("%02d",n.m)),r.push(sprintf("%02d",n.s)),r.length||r.push("0"+a.s),t.callback&&t.callback(t.timer),t.interval&&t.timer<=0&&o&&clearInterval(o),$("#timer .js-timer-time").html(r.join(" : "))};return r(),t.interval&&t.timer>0&&(o=setInterval(r,1e3)),o},$(document).ready(function(){var e=document.location.hash.match(/#token=(.*)$/);e&&"undefined"!=typeof e[1]&&(document.location.hash="",APP.FORM.send("/auth/loginCrossProjectToken/",{data:{token:e[1]}},function(e){if(e.status){var t=document.createElement("iframe");document.body.appendChild(t),t.src=APP.FORM.innerUrl("/auth/setCookie/?cookie="+e.cookie+"&expire="+e.expiration),t.onload=function(){document.location.reload()}}else document.location.reload()}))})}(),function(){"use strict";APP.POPUP={};var e=APP.POPUP,t=[],n=0;e.show=function(t,n,o,r){n=n||{},APP.UTILS.defaults(n,{propagation:!0,click:!1,dark:!1,overlay_click_hide:!0,hold:!1});var i=function(){n.dark&&e.showDark(),t.addClass("js-show").show(),"function"==typeof o&&o()},s=function(){n.dark&&e.hideDark(),t.removeClass("js-show").hide().unbind("click"),"function"==typeof r&&r()};n.overlay_click_hide?$("#popup-dark-propagator").unbind("click"):$("#popup-dark-propagator").click(function(e){return e.preventDefault(),e.stopPropagation(),!1}),n.propagation?t.click(function(e){a(t),e.stopPropagation()}):t.click(function(e){a(t),s()}),t.find(".js-popup-hide").each(function(n){$(t.find(".js-popup-hide")[n]).click(function(){e.unbind(t),s(),event.stopPropagation()})}),t.hasClass("js-show")?s():(i(),e.bind(t,s,n.hold,n.click))},e.showDark=function(){0===n&&$("#popup-dark").show().click(function(t){e.clickDark()}),n++},e.hideDark=function(){1===n&&$("#popup-dark").hide().unbind(),n=n>0?n-1:n},e.error=function(t){e.alert(t)},e.alert=function(t){var n=$("#popup-alert");e.showDark(),$(".js-popup-confirm").hide(),n.show(),$("#popup-alert .js-content").html(t).show();var a=function(){$("#popup-alert .js-content").html("").hide(),n.hide(),n.unbind(),e.hideDark(),e.unbind(n)};e.bind(n,a),n.click(function(e){a(),e.stopPropagation()})},e.bind=function(e,n,a,o){t.push({popup:e,func:n,hold:a||!1,click:o||!1})},e.unbind=function(e){t=$.map(t,function(t){if(t.popup!==e)return t})},e.hold=function(e){$.map(t,function(t){t.popup===e&&(t.hold=!0)})},e.clickDark=function(e){t=$.map(t,function(e){if(e.hold)return e.hold=!1,e;try{e.func()}catch(e){}})},e.click=function(e){t=$.map(t,function(e){if(!e.click)return e;if(e.hold)return e.hold=!1,e;try{e.func()}catch(e){}})};var a=function(e){var n=!1;t=$.map(t,function(t){if(t.popup===e)return n=!0,t;if(!n)return t;if(t.hold)return t.hold=!1,t;try{t.func()}catch(e){}})};$(document).ready(function(){$(this).bind("click",e.click)})}(),function(){"use strict";APP.FORM={};var e=APP.FORM;e.innerUrl=function(e){return e},e.send=function(e,t,n,a){APP.UTILS.defaults(t,{type:"POST",url:e,dataType:"json",data:""}),$.ajax(t).done(function(e){return"undefined"!=typeof e.error&&"undefined"==typeof e.errors?void APP.POPUP.error(e.error):void n(e)}).fail(function(e,t){try{APP.POPUP.error(e.responseJSON.error)}catch(e){APP.POPUP.error(t)}"function"==typeof a&&a(e,t)})},e.check=function(e,t,n){for(var a=0,o=t.length;a<o;a++)"undefined"!=typeof n[t[a]]&&($("#"+e+" .js-form-"+t[a]+"-error").html(n[t[a]][0]).show(),$("#"+e+" .js-form-"+t[a]).bind("keydown",function(){$("#"+e+" .js-form-"+t[a]+"-error").html("").hide().unbind("keydown")}))}}(),function(){"use strict";APP.UTILS={};var e=APP.UTILS;e.defaults=function(t,n){console.log(t),console.log(n);for(var a in n)n.hasOwnProperty(a)&&("undefined"==typeof t[a]&&("object"==typeof n[a]?t[a]={}:t[a]=n[a]),"object"==typeof t[a]&&e.defaults(t[a],n[a]))},e.parseUrl=function(e){var t={protocol:"http",host:null,port:80,path:null,query:null},n=e.toLowerCase().match(/(([a-z]+):\/\/)?(www\.)?([^\/\s]+\.[a-z]{2,4})(:[0-9]+)?([^?]+)?(\?([^\s]+))?/i);return"undefined"!=typeof n[2]&&(t.protocol=n[2]),"undefined"!=typeof n[4]&&(t.host=n[4]),"undefined"!=typeof n[5]&&(t.port=n[5]),"undefined"!=typeof n[6]&&(t.path=n[6]),"undefined"!=typeof n[8]&&(t.query=n[8]),t},e.setCookie=function(e,t,n,a,o,r){document.cookie=e+"="+escape(t)+(n?"; expires="+n:"")+(a?"; path="+a:"")+(o?"; domain="+o:"")+(r?"; secure":"")},e.getCookie=function(e){var t=" "+document.cookie,n=" "+e+"=",a=null,o=0,r=0;return t.length>0&&(o=t.indexOf(n),o!==-1&&(o+=n.length,r=t.indexOf(";",o),r===-1&&(r=t.length),a=unescape(t.substring(o,r)))),a},e.deleteCookie=function(t){var n=location.hostname;e.setCookie(t,"",-1),e.setCookie(t,"",-1,"/",n),e.setCookie(t,"",-1,"/","."+n)},e.getUrlVars=function(){return e.getLinkParams(window.location.href)},e.getLinkParams=function(e){var t={};return e.replace(/[?&]+([^=&]+)=([^&]*)/gi,function(e,n,a){a&&(t[n]=decodeURIComponent(a))}),t},e.encodeLinkParams=function(e){var t=[];for(var n in e)t.push(encodeURIComponent(n)+"="+encodeURIComponent(e[n]));return t.join("&")}}(),function(){"use strict";APP.GALLERY={};var e=APP.GALLERY,t={};t.bigSlider={arr:[],nxt:0,prv:0,cur:0},e.getNext=function(e){var n=t[e].nxt,a=t[e].prv+1,o=t[e].cur+1;return n===t[e].len&&(n=0),a===t[e].len&&(a=0),o===t[e].len&&(o=0),t[e].nxt=n+1,t[e].prv=a,t[e].cur=o,n},e.getPrev=function(e){var n=t[e].nxt-1,a=t[e].prv,o=t[e].cur-1;return 0===a&&(a=t[e].len-1),n===-1&&(n=t[e].len-1),o===-1&&(o=t[e].len-1),t[e].nxt=n,t[e].prv=a-1,t[e].cur=o,a},e.init=function(e,n,a,o,r){t[e]={arr:n,len:n.length,nxt:0,prv:0,cur:0,turnLeft:o,turnRight:r,lock:!1},a(t[e])},e.turnLeft=function(e){t[e].turnLeft(t[e])},e.turnRight=function(e){t[e].turnRight(t[e])},e.initBigSlider=function(){$(".js-img-big").each(function(e,n){var a=$(n).data("big");a&&t.bigSlider.arr.push(a)}),t.bigSlider.len=t.bigSlider.arr.length},e.addBigSlider=function(e){t.bigSlider.arr=t.bigSlider.arr.concat(e),t.bigSlider.len=t.bigSlider.arr.length},e.openBigSlider=function(n){$("#popup-image .js-popup-image").attr("src",n),$("#popup-image .js-ctrl").unbind(),$("#popup-image .js-ctrl-close").click(function(){APP.POPUP.clickDark()});var a=t.bigSlider.arr.indexOf(n);if(a!==-1&&t.bigSlider.len>1){var o=a-1<0?t.bigSlider.len-1:a-1,r=a+1>=t.bigSlider.len?0:a+1;$("#popup-image .js-ctrl-prv").click(function(){e.openBigSlider(t.bigSlider.arr[o])}),$("#popup-image .js-ctrl-nxt").click(function(){e.openBigSlider(t.bigSlider.arr[r])})}}}(),function(){"use strict";APP.CALENDAR={};var e=APP.CALENDAR,t=null,n=null,a=null,o=null,r=!1;e.load=function(e,t){APP.FORM.send("/site/calendar/",{type:"GET",data:{month:e,year:t},dataType:"html"},function(e){e&&$("#calendar").replaceWith(e)})},e.init=function(i,s,c,l,d){t=i,n=c,a=d,o=l.html(),s.each(function(t,n){n=$(n),"undefined"!=typeof n.data("events")&&(n.mouseover(function(t){if(!r){var n=$(t.currentTarget).data("events");e.tooltip_clear(),e.tooltip_fill(a[n]),e.tooltip_show()}}),n.mouseout(function(t){r||(e.tooltip_hide(),e.tooltip_clear())}),n.click(function(t){var n=$(t.currentTarget).data("events");e.tooltip_clear(),e.tooltip_fill(a[n]),e.tooltip_show(),e.tooltip_freeze($(this))}))})},e.tooltip_freeze=function(n){r||$(document).on("click.calendar",function(n){$(event.target).closest(t).length||e.tooltip_un_freeze()}),r=!0,e.clear_selected_events(),n.addClass("is-selected")},e.clear_selected_events=function(){t.find(".is-selected").removeClass("is-selected")},e.tooltip_un_freeze=function(){r=!1,e.clear_selected_events(),e.tooltip_hide(),e.tooltip_clear(),$(document).off("click.calendar")},e.tooltip_show=function(){n.removeClass("js-hidden")},e.tooltip_hide=function(){n.addClass("js-hidden")},e.tooltip_fill=function(e){n.find(".js-calendar-tooltip-title").html(e.title),$(e.events).each(function(e,t){var a=$(o);a.find(".js-calendar-tooltip-event-time").text(t.time),a.find(".js-calendar-tooltip-event-name").text(t.title).attr("href",t.url),n.find(".js-calendar-tooltip-content").append(a)})},e.tooltip_clear=function(){n.find(".js-calendar-tooltip-title").html(""),n.find(".js-calendar-tooltip-content").html("")}}(),function(){"use strict";APP.TOP={};var e=APP.TOP,t={clans:{kind:"",sortArr:[],limit:5,dataArr:[]},users:{kind:"",arr:[],limit:20,dataArr:[]}};e.clans=function(n){return t.clans.dataArr=n,e},e.users=function(n){return t.users.dataArr=n,e},e.tab=function(e,n,a,o){n&&($(n).parent("div").children(".b-rate__tab--active").removeClass("b-rate__tab--active"),$(n).addClass("b-rate__tab--active")),""!=a&&(t[e].kind=a),""!=o&&(t[e].sortArr=o);for(var r,i,s,c,l,d,u,f,p="",m=1,h=0,P=t[e].sortArr.length;h<P;h++)if(("all"==t[e].kind||t[e].kind==t[e].dataArr[t[e].sortArr[h][0]][2])&&m<=t[e].limit){if(l=m%2==0?"odd":"even",f=""==t[e].dataArr[t[e].sortArr[h][0]][5]?'src="/static/images/blank.gif?v1" style="cursor:default;"':'src="'+t[e].dataArr[t[e].sortArr[h][0]][5]+'" onclick="clanInfo(\''+t[e].dataArr[t[e].sortArr[h][0]][6]+"');\"",f+=' title="'+t[e].dataArr[t[e].sortArr[h][0]][6]+'"',c=t[e].sortArr[h][1],p+='<tr class="b-rate__tr b-rate__tr--'+l+'"><td class="b-rate__td b-rate__td--'+t[e].dataArr[t[e].sortArr[h][0]][2]+'">'+m++ +'</td><td class="b-rate__td b-rate__td--clanname"><img alt="" '+f+' width="14" height="14" class="clanInfo" />',"clans"==e)i=t[e].dataArr[t[e].sortArr[h][0]][6],s=i.length>=15?i.substr(0,14)+"..":i,p+='<a title="'+i+'" onclick="clanInfo(\''+i+'\'); return false;" href="#">'+s+"</a>";else if("users"==e){i=t[e].dataArr[t[e].sortArr[h][0]][0],r=t[e].dataArr[t[e].sortArr[h][0]][1],t[e].dataArr[t[e].sortArr[h][0]][3]>0?(d='<a href="/library/development/?part=blog2" target="_blank"><img alt="" title="'+t[e].dataArr[t[e].sortArr[h][0]][4]+'" src="/static/images/rank/rank_'+(t[e].dataArr[t[e].sortArr[h][0]][3]<10?0:"")+t[e].dataArr[t[e].sortArr[h][0]][3]+'.png" width="14" height="14" /></a>',s=r>=10?i.length>=9?i.substr(0,8)+"..":i:i.length>=10?i.substr(0,9)+"..":i):(d="",s=r>=10?i.length>=10?i.substr(0,9)+"..":i:i.length>=11?i.substr(0,10)+"..":i),u=t[e].dataArr[t[e].sortArr[h][0]][7]>1?'<a href="/library/development/?part=blog3" target="_blank"><img alt="" title="'+t[e].dataArr[t[e].sortArr[h][0]][8]+'" src="'+t[e].dataArr[t[e].sortArr[h][0]][9]+'" width="14" height="14" /></a>':"";"sadars"==t[e].dataArr[t[e].sortArr[h][0]][2]?"sadarsLink":"valorsLink";p+='<a title="'+i+'" onclick="userInfo(\''+i+'\'); return false;" href="#">'+s+"</a><span> "+u+d+r+"</span>"}p+='</td><td class="b-rate__td b-rate__td--points '+(c>=1e6?" small":"")+'">'+c+"</td></tr>"}else if(m>t[e].limit)break;$("#top-"+e+" .js-list").html(p)}}(),String.prototype.format=function(){var e=arguments,t=0;return this.replace(/%((%)|s)/g,function(n){return"undefined"!=typeof e[t]?e[t++]:n})},Date.prototype.getMonthName=function(){var e=["January","February","March","April","May","June","July","August","September","October","November","December"];return e[this.getMonth()]},Date.prototype.getMonthAbbr=function(){var e=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"];return e[this.getMonth()]},Date.prototype.getDayFull=function(){var e=["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"];return e[this.getDay()]},Date.prototype.getDayAbbr=function(){var e=["Sun","Mon","Tue","Wed","Thur","Fri","Sat"];return e[this.getDay()]},Date.prototype.getDayOfYear=function(){var e=new Date(this.getFullYear(),0,1);return Math.ceil((this-e)/864e5)},Date.prototype.getDaySuffix=function(){var e=this.getDate(),t=["th","st","nd","rd"],n=e%100;return t[(n-20)%10]||t[n]||t[0]},Date.prototype.getWeekOfYear=function(){var e=new Date(this.getFullYear(),0,1);return Math.ceil(((this-e)/864e5+e.getDay()+1)/7)},Date.prototype.isLeapYear=function(){var e=this.getFullYear();if(parseInt(e)%4==0){if(parseInt(e)%100==0){if(parseInt(e)%400!=0)return!1;if(parseInt(e)%400==0)return!0}if(parseInt(e)%100!=0)return!0}if(parseInt(e)%4!=0)return!1},Date.prototype.getMonthDayCount=function(){var e=[31,this.isLeapYear()?29:28,31,30,31,30,31,31,30,31,30,31];return e[this.getMonth()]},Date.prototype.format=function(e){e=e.split("");for(var t=this.getDate(),n=this.getMonth(),a=this.getHours(),o=this.getMinutes(),r=this.getSeconds(),i={d:t<10?"0"+t:t,D:this.getDayAbbr(),j:this.getDate(),l:this.getDayFull(),S:this.getDaySuffix(),w:this.getDay(),z:this.getDayOfYear(),W:this.getWeekOfYear(),F:this.getMonthName(),m:n<10?"0"+(n+1):n+1,M:this.getMonthAbbr(),n:n+1,t:this.getMonthDayCount(),L:this.isLeapYear()?"1":"0",Y:this.getFullYear(),y:this.getFullYear()+"".substring(2,4),a:a>12?"pm":"am",A:a>12?"PM":"AM",g:a%12>0?a%12:12,G:a>0?a:"12",h:a%12>0?a%12:12,H:a,i:o<10?"0"+o:o,s:r<10?"0"+r:r},s="",c=0;c<e.length;c++){var l=e[c];s+=l.match(/[a-zA-Z]/g)?i[l]?i[l]:"":l}return s},function(){"use strict";APP.VOTING={};var e=APP.VOTING;e.checked=function(e,t){$("#voting-"+e+" input[type=radio]").each(function(e,t){$(t).prop("checked",!1).removeAttr("checked"),$(t).parent().removeClass("is-checked")}),$(t).prop("checked",!0).attr("checked","checked"),$(t).parent().addClass("is-checked"),$("#voting-"+e+" input[type=hidden]").val($(t).val())},e.vote=function(e){if("-1"!==$("#voting-"+e+" input[type=hidden]").val()){var t=$("#voting-"+e+" form").serialize();APP.FORM.send("/site/vote/?votingId="+e,{data:t},function(t){t.status&&$("#voting-"+e).replaceWith(t.voting)})}}}(),function(){"use strict";APP.FORUM={};var e=APP.FORUM,t={},n={},a={};e.ajaxFlags={ban:!1},e.waitForComment=!1,e.init=function(){$(document).on("mouseup",".js-ban-delete",function(t){e.deleteBan(this)}),$(document).on("change",".js-filter-form input, .js-filter-form select",function(e){$(e.target).closest(".js-filter-form").submit()}),$(document).on("keyup",".js-ban-nickname",function(t){13==t.keyCode&&e.banList("/f/banuser/?userName="+encodeURIComponent($(this).val()))})},e.addUser=function(e){"undefined"==typeof t[e.id]&&(t[e.id]=e)},e.getUser=function(e){return"undefined"!=typeof t[e]&&t[e]},e.addPost=function(e){"undefined"==typeof n[e.id]&&(n[e.id]=e)},e.addComment=function(e){"undefined"==typeof a[e.id]&&(a[e.id]=e)},e.getPost=function(e){return"undefined"!=typeof n[e]&&n[e]},e.setPostsRead=function(e,t,a,o){for(var r in n){var i=$("#post-"+r+" .b-post__icon");n.hasOwnProperty(r)&&("undefined"==typeof a[r]||a[r]&&a[r]<n[r].date||1===e&&n[r].date>t)&&i.closest(".js-post").addClass("is-unread")}},e.setRubricRead=function(e){var t=0;for(var a in n)n.hasOwnProperty(a)&&n[a].date>t&&(t=n[a].date);APP.FORM.send("/f/setrubricasread/?rubricTid="+e+"&date="+t,{type:"POST"},function(e){$(".js-post").each(function(e,t){$(t).removeClass("is-unread")})})},e.getComment=function(e){return"undefined"!=typeof a[e]&&a[e]},e.deletePost=function(e,t){APP.FORM.send(e,{},function(e){"undefined"!=typeof e.redirect?document.location.href=APP.FORM.innerUrl(e.redirect):e.status&&(document.location.href=APP.FORM.innerUrl("/forum/drako/"))})},e.deleteComment=function(e,t){APP.FORM.send(e,{},function(e){e.status&&(e.admin?$("#comment-"+t).remove():$("#comment-"+t+" .js-content").html(e.message))})},e.quotePost=function(t){var n=e.getPost(t);$("#form-comment .js-form-content").val($("#form-comment .js-form-content").val()+"<quote><user>"+n.user_title+"</user>"+n.content+"</quote>").focus()},e.quoteComment=function(t){var n=e.getComment(t);$("#form-comment .js-form-content").val($("#form-comment .js-form-content").val()+"<quote><user>"+n.user_title+"</user>"+n.content+"</quote>").focus()},e.replyComment=function(t){var n=e.getComment(t);$("#form-comment .js-form-content").val($("#form-comment .js-form-content").val()+"<b>"+n.user_title+"</b>, ").focus()},e.forumList=function(e){$("#popup-movepost-content").html(""),APP.POPUP.clickDark(),APP.FORM.send(e,{type:"GET"},function(e){e.list&&($("#popup-movepost-content").html(e.list),APP.POPUP.show($("#popup-movepost"),{dark:!0}))})},e.movePost=function(e,t){APP.FORM.send(e,{},function(e){e.status&&($("#post-"+t).remove(),APP.POPUP.clickDark())})},e.closePost=function(e,t,n){APP.FORM.send(e,{},function(e){if(e.status){var a=$("#"+t);a.hasClass(n.open)?a.removeClass(n.open).addClass(n.close):a.removeClass(n.close).addClass(n.open)}})},e.banList=function(e){$("#popup-ban-content").html(""),APP.POPUP.clickDark(),APP.FORM.send(e,{type:"GET"},function(e){e.list&&($("#popup-ban-content").html(e.list),APP.POPUP.show($("#popup-ban"),{dark:!0}))})},e.banUser=function(t){e.ajaxFlags.ban||(e.ajaxFlags.ban=!0,APP.FORM.send(t,{data:{content:$(".js-ban-list [name=Reason]").val()}},function(t){t.status&&(APP.POPUP.clickDark(),APP.POPUP.alert(t.message),e.ajaxFlags.ban=!1)},function(t,n){e.ajaxFlags.ban=!1}))},e.deleteBan=function(e){APP.FORM.send("/f/deleteBan/?id="+$(e).data("ban_id"),{},function(t){$(e).closest(".js-ban-row").next("div").next("hr").hide(),$(e).closest(".js-ban-row").next("div").hide(),$(e).closest(".js-ban-row").remove()})},e.loadComments=function(e,t,n){"undefined"==typeof t&&(t=!0),APP.FORM.send(e,{type:"GET"},function(a){if("undefined"!=typeof a.comments){var o=$("#comment-list");if(t&&$("html, body").animate({scrollTop:parseInt(o.offset().top)-parseInt($(document.body).css("padding-top"))}),"undefined"==typeof n||n){var r=APP.UTILS.getLinkParams(e),i=APP.UTILS.getUrlVars();void 0==typeof r.page||1==r.page?delete i.page:i.page=r.page;var s=location.protocol+"//"+location.host+location.pathname+"?"+APP.UTILS.encodeLinkParams(i);window.history.pushState({},"",s)}o.replaceWith(a.comments)}})},e.sendPost=function(e,t){var n=t>0?"form-post-"+t:"form-post";APP.FORM.send(e,{data:$("#"+n).serialize()},function(e){return"undefined"!=typeof e.errors?void APP.FORM.check(n,["title","content"],e.errors):void(t>0?"undefined"!=typeof e.post&&$("#"+n).replaceWith(e.post):"undefined"!=typeof e.redirect&&(document.location=APP.FORM.innerUrl(e.redirect)))})},e.loadPostForm=function(e,t){APP.FORM.send(e,{type:"GET"},function(e){"undefined"!=typeof e.post&&$("#post-"+t).replaceWith(e.post)})},e.sendComment=function(t,n){if(!e.waitForComment){e.waitForComment=!0;var a=n>0?"form-comment-"+n:"form-comment";APP.FORM.send(t,{data:$("#"+a).serialize()},function(t){return e.waitForComment=!1,"undefined"!=typeof t.errors?void APP.FORM.check(a,["content"],t.errors):void(n>0?"undefined"!=typeof t.comment&&$("#comment-"+n).replaceWith(t.comment):($("#"+a+" .js-form-content").val(""),"undefined"!=typeof t.comments&&$("#comment-list").replaceWith(t.comments)))},function(){e.waitForComment=!1})}},e.loadCommentForm=function(e,t){APP.FORM.send(e,{type:"GET"},function(e){"undefined"!=typeof e.comment&&$("#comment-"+t).replaceWith(e.comment)})},e.loadHistory=function(e,t,n){var a=$(e).next();a.hasClass("js-hidden")?APP.FORM.send("/f/updateHistory",{type:"GET",data:{id:t,type:n}},function(e){"undefined"!=typeof e.history&&(a.html(e.history),a.removeClass("js-hidden"),a.show())}):(a.addClass("js-hidden"),a.hide())},e.showHistoryDetails=function(e){$(e).next().toggleClass("js-hidden")},e.decorateTag=function(e,t){var n=document.getElementById(e),a="<"+t+">",o="</"+t+">";if(n.focus(),document.selection){var r=document.selection.createRange();r.text=a+r.text+o}else if(n.selectionStart||0===n.selectionStart){var i=$("#"+e).val(),s=n.selectionStart,c=n.selectionEnd,l=a+i.substr(s,c-s)+o;$("#"+e).val(i.substr(0,s)+l+i.substr(c))}};var o={smile:"/static/images/smiles/smile.png",sad:"/static/images/smiles/sad.png",chuckle:"/static/images/smiles/chuckle.png",cool:"/static/images/smiles/cool.png",lupeg:"/static/images/smiles/lupeg.png",wink:"/static/images/smiles/wink.png",sorrow:"/static/images/smiles/sorrow.png",sweat:"/static/images/smiles/sweat.png",beer:"/static/images/smiles/beer.png"};e.putSmile=function(e,t,n){var a=document.getElementById(e);if(t='<smile name="'+t+'"></smile>',a.focus(),document.selection){var o=document.selection.createRange();o.text=t}else if(a.selectionStart||0===a.selectionStart){var r=$("#"+e).val(),i=a.selectionStart,s=a.selectionEnd;$("#"+e).val(r.substr(0,i)+t+r.substr(s))}"undefined"==typeof n&&APP.POPUP.clickDark()},e.setSmiles=function(e){var t=e.find("smile");t.each(function(e){var n=$(t[e]).attr("name");$(t[e]).replaceWith('<img class="b-smile" width="28" height="28" src="'+o[n]+'" />')})},e.setColors=function(e){var t=e.find("color");t.each(function(e){var n=$(t[e]);n.replaceWith('<span style="color: '+n.attr("code")+'">'+n.text()+"</span>")});var n=e.find("class");n.each(function(e){var t=$(n[e]);t.replaceWith('<span class="'+t.attr("name")+'">'+t.text()+"</span>")})},e.setQuotes=function(t,n,a){var o=t.find(" > quote");n=n||0,o.each(function(t){if("undefined"!=typeof o[t]){var a=$(o[t]),r=a.children("user"),i={user:r.attr("class")?" "+r.attr("class"):"",post:$(a).attr("class")?" "+$(a).attr("class")+'"':""};e.setQuotes(a,n+10,i),r.replaceWith('<div class="b-quote__author'+i.user+'">'+r.html()+":</div>"),a.replaceWith('<div class="b-quote"><div class="b-quote__message'+i.post+'">'+a.html()+"</div></div>")}})},e.loadFeed=function(e){loadFromUrl(e,"post-list",$("#post-list form").serialize(),"replace","post",function(t){window.history&&window.history.pushState({},"",e)})},e.setFeedPeriod=function(e){var t=new Date((new Date).getTime()-60*(e-1)*60*24*1e3),n=new Date((new Date).getTime()),a=t.getMonth()+1;a<10&&(a="0"+a);var o=n.getMonth()+1;o<10&&(o="0"+o),$("#post-list form").find("[name=date_start]").val(t.getDate()+"."+a+"."+t.getFullYear()),$("#post-list form").find("[name=date_end]").val(n.getDate()+"."+o+"."+n.getFullYear()),$("#post-list form").submit()}}(),APP.FORUM.init(),function(){"use strict";APP.AUTH={};var e=APP.AUTH,t={},n=function(e){APP.FORM.send("/auth/login/",{data:t},function(e){if(e.status){var t=document.createElement("iframe");document.body.appendChild(t),t.src=APP.FORM.innerUrl("/auth/setCookie?cookie="+e.cookie+"&expire="+e.expiration),t.onload=function(){document.location.reload()}}e.go_reg&&(APP.POPUP.clickDark(),APP.POPUP.show($("#popup-register-2"),{dark:!0}))})};e.login=function(){var e=$("#form-login input[name=email]"),a=$("#form-login input[name=password]");return""===e.val()?(c(e,APP.I18N.t("Введите e-mail")),e.change(function(){i(e)}),!1):""===a.val()?(c(a,APP.I18N.t("Введите пароль")),a.change(function(){i(a)}),!1):(t.email=e.val(),t.password=a.val(),t.remember=$("#form-login input[name=remember]").attr("checked")?1:0,void n())},e.resetLogin=function(){$("#form-login input[name=email]").val(""),$("#form-login input[name=password]").val("")},e.togglePassView=function(){var e=$("#form-register input[name=password]"),t=$("#form-register input[name=password2]");"password"===e.attr("type")?(e.attr("type","text"),t.attr("type","text")):(e.attr("type","password"),t.attr("type","password"))},e.loginSocial=function(e){var a=APP.SOCIAL.apps[e];a.authorize(function(o,r){if(!o)return void APP.POPUP.error(a.getErrorString(r));var i=a.getTokenData(r);t.appCode=e,t.tokenData=i,t.remember=$("#form-login input[name=remember]").attr("checked")?1:0,n(a)})},e.bindFb=function(){$("#popup-register .icon-fb").parent().hasClass("_active")?($("#popup-register .icon-fb").parent().removeClass("_active"),e.unbindSocial()):($("#popup-register .icon-fb").parent().addClass("_active"),e.bindSocial("fb"))},e.bindSocial=function(e){var n=APP.SOCIAL.apps[e];n.authorize(function(r,i){if(!r)return void APP.POPUP.error(n.getErrorString(i));var s=n.getTokenData(i);t.appCode=e,t.tokenData=s,n.getUserInfo(function(e){t.email=e.email,d(a,["password","password2","password-show"]),o({email:{val:e.email,attr:["disabled","disabled"]}})})})},e.unbindSocial=function(){delete t.appCode,delete t.tokenData,u(a,["password","password2","password-show"]),o({email:{attr:["disabled",!1]}})},e.logout=function(){APP.FORM.send("/auth/logout/",{},function(e){if(e.status){var t=document.createElement("iframe");document.body.appendChild(t),t.src=APP.FORM.innerUrl("/auth/setCookie?cookie=0&expire="+parseInt(Date.now()/1e3)),t.onload=function(){console.log("iframe"),document.location.reload()}}})};var a=[];e.initRegister=function(){a=[{name:"email",field:$("#form-register input[name=email]"),param:null,label:$("#register-field-email"),check:e.checkEmail,hold:!0},{name:"newPassword",field:$("#form-register input[name=password]"),param:null,label:$("#register-field-password"),check:e.checkPass,hold:!0},{name:"newPassword2",field:$("#form-register input[name=password2]"),param:$("#register-field-password input[name=password]"),label:$("#register-field-password2"),check:e.checkPass2,hold:!0},{name:"login",field:$("#form-register input[name=login]"),param:null,label:$("#register-field-login"),check:e.checkLogin,hold:!0},{name:"regAgree",field:$("#form-register input[name=regAgree]"),param:null,label:$("#register-field-agree"),check:e.checkAgree,hold:!0}],$.map(a,function(e){e.field&&e.field.change(e.param,e.check)})},e.resetRegister=function(){l(a)};var o=function(e){$.map(a,function(t){e.hasOwnProperty(t.name)&&("undefined"!=typeof e[t.name].val&&t.field.val(e[t.name].val),"undefined"!=typeof e[t.name].attr&&(e[t.name].attr[1]?t.field.attr(e[t.name].attr[0],e[t.name].attr[1]):t.field.removeAttr(e[t.name].attr[0])));
})};e.register=function(e){var n=!0;if($.map(a,function(e){e.hold&&e.field&&(n=e.param?n&&e.check.apply(e.field,e.param):n&&e.check.apply(e.field))}),delete t.login,delete t.password,n&&$("#reg_agree").is(":checked")){var o=$.param(t)+"&"+$("#form-register").serialize();APP.FORM.send("/auth/registration/",{data:o},function(e){if(e.errors)return $.map(a,function(t){"undefined"!=typeof e.errors[t.name]&&""!==e.errors[t.name]&&c(t.field,e.errors[t.name])}),e.errors.social&&APP.POPUP.error(e.errors.social),!1;if(e.status){try{yaCounter30811071.reachGoal("install"),ga("send","event","site","register","account",2),yaCounter31605898.reachGoal("REGISTER")}catch(e){}var t=document.createElement("iframe");document.body.appendChild(t),t.src=APP.FORM.innerUrl("/auth/setCookie?cookie="+e.cookie+"&expire="+e.expiration),t.onload=function(){console.log("iframe"),document.location.reload()}}})}},e.register2=function(e){var n=$.param(t)+"&"+$("#form-register-2").serialize();APP.FORM.send("/auth/registration/",{data:n},function(e){if(e.errors)return $.map(a,function(t){"undefined"!=typeof e.errors[t.name]&&""!==e.errors[t.name]&&c(t.field,e.errors[t.name])}),e.errors.social&&APP.POPUP.error(e.errors.social),!1;if(e.status){var t=document.createElement("iframe");document.body.appendChild(t),t.src=APP.FORM.innerUrl("/auth/setCookie?cookie="+e.cookie+"&expire="+e.expiration),t.onload=function(){console.log("iframe"),document.location.reload()}}})},e.showPassword=function(e){var t=$("#register-field-password input[name=password]");"password"===t.attr("type")?(t.attr("type","text"),$(e).addClass("button_active")):(t.attr("type","password"),$(e).removeClass("button_active"))};var r=[];e.initChangePassword=function(){r=[{name:"oldPassword",field:$("#form-change-password input[name=oldPassword]"),param:null,label:$("#change-password-field-password"),check:e.checkPass,hold:!0},{name:"newPassword",field:$("#form-change-password input[name=newPassword]"),param:null,label:$("#change-password-field-password1"),check:e.checkPass,hold:!0},{name:"newPassword2",field:$("#form-change-password input[name=newPassword2]"),param:$("#form-change-password input[name=newPassword]"),label:$("#change-password-field-password2"),check:e.checkPass2,hold:!0}],$.map(r,function(e){e.field.change(e.param,e.check)})},e.resetChangePassword=function(){l(r)},e.changePassword=function(){var t=$("#form-change-password input[name=sign]").val();t&&d(r,["oldPassword"]);var n=!0;if($.map(r,function(e){e.hold&&(n=n&&e.check.apply(e.field,e.param))}),n){var a=$("#form-change-password").serialize();APP.FORM.send("/auth/changePassword/",{data:a},function(n){return n.errors?($.map(r,function(e){"undefined"!=typeof n.errors[e.name]&&""!==n.errors[e.name]&&c(e.field,n.errors[e.name])}),!1):void(n.status?(APP.POPUP.error(APP.I18N.t("Пароль изменен")),setTimeout(function(){APP.POPUP.click(),e.resetChangePassword(),t&&(document.location.href="/")},1e3)):t&&document.location.reload())})}},e.changePassword2=function(){var e=$("#form-change-password2").serialize();APP.FORM.send("/auth/changePassword/",{data:e},function(e){return e.errors?(APP.POPUP.error(APP.I18N.t(e.errors.pop())),!1):void(e.status&&(APP.POPUP.error(APP.I18N.t("Пароль изменен")),$("#form-change-password2 input[name=oldPassword]").val(""),$("#form-change-password2 input[name=newPassword]").val("")))})},e.forgetPassword=function(){var t=$("#form-miss input[name=email]");if(e.checkEmail.apply(t)){var n=$("#form-miss").serialize();APP.FORM.send("/auth/forgetPassword/",{data:n},function(e){e.status&&(APP.POPUP.error(APP.I18N.t("Письмо отправленно")),setTimeout(function(){APP.POPUP.clickDark(),t.val("")},1e3))})}},e.checkEmail=function(){var e=$(this).val();return e.match(/^[\w\.\-]+\@[\w][\w\-]*(\.[\w][\w\-]+)*\.[a-zA-Z]{2,6}$/)?(s($(this)),!0):(c($(this),APP.I18N.t("Некорректный email")),!1)},e.checkPass=function(){var e=$(this).val();return e.match(/^[A-Za-z0-9_-]{4,20}$/)?(s($(this)),!0):(c($(this),APP.I18N.t("Некорректный пароль")),!1)},e.checkPass2=function(e){var t=$(this).val(),n="undefined"!=typeof e.data?$(e.data[0]).val():$(e).val();return n==t?(s($(this)),!0):(c($(this),APP.I18N.t("Некорректный пароль")),!1)},e.checkLogin=function(){var e=$(this).val().trim();try{if(e.length<3)throw"Слишком короткое имя персонажа";if(e.length>18)throw"Слишком длинное имя персонажа";if(e.match(/^\d/))throw"Имя персонажа не может начинаться с цифр";return s($(this)),!0}catch(e){return c($(this),APP.I18N.t(e)),!1}},e.checkAgree=function(){console.log(this);try{if(!$(this).is(":checked"))throw"Нужно принять условия регистрации";return s($(this)),!0}catch(e){return c($(this),APP.I18N.t(e)),!1}};var i=function(e){e.parents(".b-form__field").removeClass("_success").removeClass("_error"),e.parent().children(".js-status").remove()},s=function(e){i(e),e.parents(".b-form__field").removeClass("_error").addClass("_success"),e.parent().append('<div class="b-field__status js-status"><span class="b-field__status-text">OK</span></div>')},c=function(e,t){i(e),e.parents(".b-form__field").removeClass("_success").addClass("_error"),e.parent().append('<div class="b-field__status js-status"><span class="b-field__status-text">'+t+"</span></div>")},l=function(e){$.map(e,function(e){e.field.val(""),e.label.show(),e.hold=!0,i(e.field)})},d=function(e,t){$.map(e,function(e){t.indexOf(e.name)!==-1&&(e.label.hide(),e.hold=!1)})},u=function(e,t){$.map(e,function(e){t.indexOf(e.name)!==-1&&(e.label.show(),e.hold=!0)})}}(),function(){"use strict";APP.CLAN={};var e=APP.CLAN,t=1500,n=1,a=0;e.search=function(){var e=$("#clan-search-title").val().trim();APP.FORM.send("/clans/json/",{type:"GET",data:{title:e}},function(e){"undefined"!=typeof e.clans&&$("#clan-list").replaceWith(e.clans)})},e.load=function(e){APP.FORM.send(e,{type:"GET"},function(e){"undefined"!=typeof e.clans&&$("#clan-list").replaceWith(e.clans)})},e.create=function(){APP.FORM.send("/clans/create/",{type:"POST",data:$("#form-clan").serialize()},function(e){e.status&&(document.location.href=APP.FORM.innerUrl("/clans/"+e.id+".html"))})},e.update=function(){var e={title:$("#clan-title").val(),content:$("#clan-content").val()};APP.FORM.send("/clans/update/",{type:"POST",data:e},function(e){e.status&&(APP.POPUP.alert(e.message),setTimeout(function(){document.location.href=document.location.href},t))})},e.sendRequest=function(e){APP.FORM.send("/clans/sendRequest/",{type:"POST",data:{clanId:e}},function(e){e.status&&APP.POPUP.alert(e.message)})},e.acceptRequest=function(e){APP.FORM.send("/clans/acceptRequest/",{type:"POST",data:{userId:e}},function(e){e.status&&(APP.POPUP.alert(e.message),setTimeout(function(){document.location.href=document.location.href},t))})},e.declineRequest=function(e){APP.FORM.send("/clans/declineRequest/",{type:"POST",data:{userId:e}},function(e){e.status&&(APP.POPUP.alert(e.message),setTimeout(function(){document.location.href=document.location.href},t))})},e.leave=function(){APP.FORM.send("/clans/leave/",{type:"POST"},function(e){e.status&&(APP.POPUP.alert(e.message),setTimeout(function(){document.location.href=APP.FORM.innerUrl("/clans/")},t))})},e.showFire=function(e,t){i({id:e,title:APP.I18N.t("Исключить из клана"),text:APP.I18N.t("Вы уверены, что хотите исключить из клана %s?").format(t),ok:function(){return APP.CLAN.fire(),!1}})},e.fire=function(){var e=$("#popup-clan-confirm-id").val();APP.FORM.send("/clans/fire/",{type:"POST",data:{userId:e}},function(e){e.status&&(APP.POPUP.alert(e.message),setTimeout(function(){document.location.href=document.location.href},t))})},e.showChangeLeader=function(e,t){i({id:e,title:APP.I18N.t("Назначить лидером"),text:APP.I18N.t("Вы уверены, что хотите назначить лидером %s?").format(t),ok:function(){return APP.CLAN.changeLeader(),!1}})},e.changeLeader=function(){var e=$("#popup-clan-confirm-id").val();APP.FORM.send("/clans/changeLeader/",{type:"POST",data:{userId:e}},function(e){e.status&&(APP.POPUP.alert(e.message),setTimeout(function(){document.location.href=document.location.href},t))})},e.showDismiss=function(){i({title:APP.I18N.t("Распустить клан"),text:APP.I18N.t("Вы уверены, что хотите распустить клан?"),ok:function(){return APP.CLAN.dismiss(),!1}})},e.dismiss=function(){APP.FORM.send("/clans/dismiss/",{type:"POST"},function(e){e.status&&(APP.POPUP.alert(e.message),setTimeout(function(){document.location.href=APP.FORM.innerUrl("/clans/")},t))})},e.turnLeftIcons=function(t,i){r();for(var s=n-2,c=1;c<=t;c++)s++,s>i&&(s=1),s<=0&&(s=i),$("#clanIcon"+c).attr("src","/static/images/clans/pictures/34x34/S"+(s<10?"0"+s:s)+".png"),function(t,n){$("#clanIcon"+n).click(function(a){e.setIcon(t,$("#clanIcon"+n))})}(s,c),s===a&&o($("#clanIcon"+c));n--,n<=0&&(n=i)},e.turnRightIcons=function(t,i){r();for(var s=n,c=1;c<=t;c++)s++,s>i&&(s=1),$("#clanIcon"+c).attr("src","/static/images/clans/pictures/34x34/S"+(s<10?"0"+s:s)+".png"),function(t,n){$("#clanIcon"+n).click(function(a){e.setIcon(t,$("#clanIcon"+n))})}(s,c),s===a&&o($("#clanIcon"+c));n++,n>i&&(n=1)},e.setIcon=function(e,t){a=e,$("#form-clan input[name=picture]").val(e),r(),o(t)};var o=function(e){$(e.parents()[0]).addClass("active")},r=function(){console.log("unset"),$("#form-clan .js-clanIcon-border").each(function(e,t){$(t).removeClass("active")})},i=function(e){"undefined"!==e.id&&$("#popup-clan-confirm-id").val(e.id),$("#popup-clan-confirm-title").html(e.title),$("#popup-clan-confirm-text").html(e.text),$("#popup-clan-confirm-ok").unbind(),$("#popup-clan-confirm-ok").click(e.ok),APP.POPUP.show($("#popup-clan-confirm"),{dark:!0})}}(),function(){"use strict";APP.PROFILE={};var e=APP.PROFILE,t="";e.pictureId=0,e.setAvatar=function(n,a,o){e.pictureId=n,t=a,$(".b-avatar").removeClass("b-avatar_active"),$(o).addClass("b-avatar_active")},e.selectAvatar=function(){$("#self.pictureId").val(e.pictureId),$(".js-avatar").attr("src",t),APP.POPUP.clickDark()},e.init=function(){$(".js-gender-male").click(function(){return $(".js-gender-male").addClass("b-button--primary"),$(".js-gender-female").removeClass("b-button--primary"),$(".js-gender").val(1),!1}),$(".js-gender-female").click(function(){return $(".js-gender-female").addClass("b-button--primary"),$(".js-gender-male").removeClass("b-button--primary"),$(".js-gender").val(2),!1}),$(".js-date-day").keyup(function(){var e=$(this),t=e.val().match("^[0-9]+$");!t||"undefined"==typeof t[0]||t[0]<1||t[0]>31?e.addClass("_error"):e.removeClass("_error")}),$(".js-date-month").keyup(function(){var e=$(this),t=e.val().match("^[0-9]+$");!t||"undefined"==typeof t[0]||t[0]<1||t[0]>12?e.addClass("_error"):e.removeClass("_error")}),$(".js-date-year").keyup(function(){var e=$(this),t=e.val().match("^[0-9]+$"),n=new Date;!t||"undefined"==typeof t[0]||t[0]<n.getFullYear()-100||t[0]>n.getFullYear()?e.addClass("_error"):e.removeClass("_error")})},e.markCurrentPhoto=function(e){var t=Math.floor(e/3),n=e%3;$(".active").css({top:90*t+"px",left:88*n+1+"px"}).show()},e.deletePhoto=function(t){$("#popup-delete-photo-confirm").unbind("click").bind("click",function(){$.ajax({url:"/gallery/delete/",type:"post",data:"id="+t,success:function(n){if($("#popup-delete-photo-confirm").unbind("click"),APP.POPUP.clickDark(),"ok"==n)if(window.location.reload(),t==e.pictureId)window.location.reload();else{var a=1;$(".photosBlock .pager").length>0&&(a=$(".photosBlock .pager .page-active").html()),loadFromUrl("/user/galleryphotos/?type=ax&i="+a,$(".photosBlock"),"","i","get")}}})}),APP.POPUP.show($("#popup-delete-photo"),{dark:!0})},e.deleteCurrentPhoto=function(){e.deletePhoto(e.pictureId)},e.savePhoto=function(){$("#btn").hasClass("inert")||$.ajax({url:"/user/galleryupdate/",type:"post",data:$("#imageForm").serialize(),success:function(t){1==t&&($("#btn").addClass("inert"),profileAlbumArr[e.pictureId][3]=$("#formContent").val())}})},e.makeAvatar=function(t){$.ajax({url:"/user/setavatar/",type:"post",data:"id="+t,success:function(n){"ok"==n&&($(".js-delAvatar").length>0?(e.oldAvatarId=$(".js-delAvatar").prevAll("img:first").attr("id").replace(/photo/gi,""),profileAlbumArr[e.oldAvatarId][4]=0,$(".js-delAvatar").replaceWith('<span class="profile-thumb-item__icon-make-avatar b-icon b-icon--btn-make-avatar js-makeAvatar" onclick="APP.PROFILE.makeAvatar('+e.oldAvatarId+');"></span>'),e.replaceAvaButton(e.oldAvatarId)):e.oldAvatarId=t,profileAlbumArr[t][4]=1,$("#photo"+t).parent("div").find(".js-makeAvatar").replaceWith('<span class="profile-thumb-item__icon-delete-avatar b-icon b-icon--btn-delete-avatar js-delAvatar" onclick="APP.PROFILE.deleteAvatar('+t+');"></span>'),e.replaceAvaButton(t))}})},e.makeNewAvatar=function(){if(!($(".js-photo").length<2)){var t=$(".js-photo:first").data("id");e.makeAvatar(t)}},e.deleteAvatar=function(t){$.ajax({url:"/user/delavatar/",type:"post",data:"id="+t,success:function(n){"ok"==n&&(profileAlbumArr[t][4]=0,$(".js-delAvatar").replaceWith('<span class="profile-thumb-item__icon-make-avatar b-icon b-icon--btn-make-avatar js-makeAvatar" onclick="APP.PROFILE.makeAvatar('+e.oldAvatarId+');"></span>'),e.replaceAvaButton(t))}})},e.replaceAvaButton=function(t){t==e.pictureId&&($(".devidedTplPart1 .avaButton").remove(),1==profileAlbumArr[t][4]?$(".devidedTplPart1 .neg").after('<div class="btn neg avaButton" onclick="APP.PROFILE.deleteAvatar('+t+'); return false;"><span class="b-button__link">'+profileChangeAvatarG[1]+"</span></div>"):$(".devidedTplPart1 .aff").after('<div class="btn aff avaButton" onclick="APP.PROFILE.makeAvatar('+t+'); return false;"><span class="b-button__link">'+profileChangeAvatarG[0]+"</span></div>"))},e.successUpload0=function(e,t){$(".profileBlock .photoUploadBlock .preloader").hide(),$(".profileBlock .oldPhoto").val(e.image);var n="?r="+Math.random();$(".profileBlock .photoUploadBlock img").attr("src",e.src0+n).css("cursor","pointer").unbind().bind("click",function(){userPhotoOpen(e.width,e.height,e.src1+n)})},e.successUpload1=function(e,t){10==e.error?alert("error"):window.location.reload()},e.errorUpload0=function(e){$(".profileBlock .photoUploadBlock .preloader").hide(),console.log(e),APP.POPUP.alert(msg.message)},e.errorUpload1=function(e){$(".inputFileLocation").html(fileUploadG[1]),console.log(e)}}(),function(){"use strict";var e=APP.tmpl,t={};e.load=function(e){for(var t in APP.data.templates)n(APP.data.templates[t],e)},e.render=function(e,a){return t[e]||n(e),$.tmpl(e,a)},e.init=function(){e.load()};var n=function(e,n){var a=APP.cst.PATH_TMPL+e+".tmpl";$.ajax({url:a,cache:!1,dataType:"text",success:function(t){$.template(e,t),o(e,n)},error:function(){o(e,n)}});var o=function(e,n){t[e]={},n&&t.length==APP.data.templates.length&&n()}}}(),function(){"use strict";APP.modules.bots={};var e=APP.modules.bots,t={},n=null;e.init=function(){resetForm($("#botForm")),APP.modules.bots.bind("bIt")},e.bind=function(e){return!0},e.search=function(a){$("#"+n+"Bl").addClass("hidden"),$("#"+n+"Ul").html("");var o=jQuery.trim($(a).val());return""==o?void $("#"+n+"H").val(0):(o=o.toLowerCase(),void(t[o[0]]?e.select(o):$.ajax({url:"/entity/itemsjson/",data:"item="+o[0],type:"post",dataType:"json",success:function(n){t[o[0]]=n.items,e.select(o)}})))},e.resetForm=function(){$("#bItBl").addClass("hidden"),$("#bItUl").html(""),resetForm($("#botForm"),{filterInp:"1"}),inpLabPreset("filter"),$("#botForm").submit(),document.location.hash=""},e.select=function(e){for(var a=!1,o=0,r=t[e[0]].length;o<r;o++)0==t[e[0]][o].search.indexOf(e)&&(a=!0,$("#"+n+"Ul").append("<li onclick=\"$('#"+n+"').val('"+t[e[0]][o].title+"'); $('#"+n+"H').val("+t[e[0]][o].id+"); $('#"+n+"Bl').addClass('hidden');\">"+t[e[0]][o].title+"</li>"));a&&$("#"+n+"Bl").removeClass("hidden")},e.load=function(e){console.log(e),loadFromUrl(e,$("#botListContainer"),$("#botForm").serialize(),"i","get")}}(),function(e){"use strict";APP.PJAX={};var t=APP.PJAX;t.init=function(){},t.watch=function(e,t,n){$(document).on("click",e,function(e){e.preventDefault();var a=APP.UTILS.getLinkParams($(this).attr("href")),o={type:"GET",url:$(this).attr("href").replace(/[?&]+([^=&]+)=([^&]*)/gi,""),container:t,data:a,dataType:"html"};"function"==typeof n&&(o.mySuccess=n),$.pjax(o)})}}(),APP.PJAX.init(),$(document).ready(function(){$("select").selectric({disableOnMobile:!1})}),function(){function e(e){var t=4,n=30,a=e.val().split("\n").length;a>=t&&a<=n&&e.attr("rows",a),a<t&&e.attr("rows",t),a>n&&e.attr("rows",n)}function t(){$(".js-resized-textarea").each(function(t,n){e($(n)),$(n).on("keydown",function(){var t=$(this);e(t)}),$(n).on("keyup",function(){var t=$(this);e(t)})})}$(document).ready(function(){t(),$(".b-btn--checkbox").find('input[type="checkbox"]').each(function(e,t){var n,a;if(a=$(t),n=a.parents(".b-btn--checkbox:first"),a.is(":checked"))return n.addClass("b-btn--checkbox_checked")}),$(".b-btn--checkbox").find('input[type="checkbox"]').change(function(){var e,t;return t=$(this),e=t.parents(".b-btn--checkbox:first"),t.is(":checked")?e.addClass("b-btn--checkbox_checked"):e.removeClass("b-btn--checkbox_checked")}),$(".js-single-slider").slick({slidesToShow:1,slidesToScroll:1,autoplay:!0,fade:!0,infinite:!0,speed:500,autoplaySpeed:5e3,centerPadding:0,prevArrow:!1,nextArrow:!1,lazyLoad:"ondemand",zIndex:10}),$(".js-preview-slider").slick({speed:300,slidesToShow:1,slidesToScroll:1,arrows:!1,fade:!0,cssEase:"linear",lazyLoad:"ondemand",asNavFor:".js-thumbs-slick",autoplaySpeed:5e3}),$(".js-thumbs-slick").slick({variableWidth:!0,autoplaySpeed:5e3,speed:300,slidesToShow:3,slidesToScroll:1,asNavFor:".js-preview-slider",dots:!1,centerMode:!0,focusOnSelect:!0,centerPadding:0,cssEase:"linear",prevArrow:'<div class="b-slider__nav b-slider__nav--prev"></div>',nextArrow:'<div class="b-slider__nav b-slider__nav--next"></div>'}),$(".js-slick-gallery-thumbs").slick({variableWidth:!0,autoplaySpeed:5e3,speed:300,slidesToShow:3,slidesToScroll:1,asNavFor:".js-slick-gallery-preview",dots:!1,centerMode:!0,focusOnSelect:!0,centerPadding:0,cssEase:"linear",prevArrow:'<div class="b-slider__nav b-slider__nav--prev"></div>',nextArrow:'<div class="b-slider__nav b-slider__nav--next"></div>'}),$(".js-slick-gallery-preview").slick({speed:300,slidesToShow:1,slidesToScroll:1,arrows:!1,fade:!0,initialSlide:1,infinite:!0,cssEase:"linear",lazyLoad:"ondemand",asNavFor:".js-slick-gallery-thumbs"}),$(".js-carousel").slick({slidesToShow:1,slidesToScroll:1,autoplay:!0,fade:!0,infinite:!0,speed:500,autoplaySpeed:5e3,centerPadding:0,prevArrow:!1,nextArrow:!1,accessibility:!1,lazyLoad:"progressive",prevArrow:'<div class="b-carousel__nav b-carousel__nav--prev"></div>',nextArrow:'<div class="b-carousel__nav b-carousel__nav--next"></div>',zIndex:10}),$(".js-fancybox, .fancybox, .screenshot-popup").fancybox({padding:[40,40,40,40],openSpeed:100,closeSpeed:100,nextSpeed:0,prevSpeed:0,prevEffect:"fade",nextEffect:"fade",overlay:{locked:!1},helpers:{media:!0}}),$(".js-btn-toggle").click(function(){var e,t,n;return e=$(this),t=e.find(".b-icon:first"),n=e.parents(".js-btn-toggle-parent:first").find(".js-btn-toggle-input:first"),e.toggleClass("b-btn--primary"),t.toggleClass("b-icon--show-active"),e.hasClass("b-btn--primary")?n.attr("type","text"):n.attr("type","password")}),$(".js-tabs").tabs(),$.each($(".table-common, .common-tbl, .b-table.b-table--common"),function(e,t){var n;return n=$(t),n.hasClass("b-table")||n.addClass("b-table b-table--common"),n.find("tr:even").addClass("row-odd"),n.find("tr:odd").addClass("row-even")})})}.call(this);